\section{Costos}

\subsection{Costos para Delta}

\subsubsection{Selección de Tipos de Instancias AWS}

Basados en los requisitos de recursos, seleccionaremos los tipos de instancias EC2 apropiados:

\textbf{Componentes Flink (Job Manager y Task Managers)}

\begin{itemize}
    \item \textbf{Job Manager}: Requiere 2.5 núcleos y 3.5GB RAM
    \begin{itemize}
        \item Instancia recomendada: \texttt{c5.large} (2 vCPU, 4GB RAM)
    \end{itemize}
    
    \item \textbf{Task Managers}: Requieren 1.66-2.08 núcleos y 7.5-9.7GB RAM
    \begin{itemize}
        \item Instancia recomendada: \texttt{r5.large} (2 vCPU, 16GB RAM) para todos los task managers
        \item Aunque podríamos usar instancias más pequeñas para algunos task managers, usar el mismo tipo de instancia simplifica la gestión
    \end{itemize}
\end{itemize}

\subsubsection{Brokers Kafka}

\begin{itemize}
    \item \textbf{Nodos Kafka}: Requieren 1.76-2.74 núcleos y 2.7GB RAM cada uno
    \begin{itemize}
        \item Instancia recomendada: \texttt{c5.large} (2 vCPU, 4GB RAM) para todos los nodos Kafka
        \item Cada uno necesita 38GB de almacenamiento, que aprovisionaremos con volúmenes EBS gp3
    \end{itemize}
\end{itemize}

\subsubsection{Apache Doris}

\begin{itemize}
    \item \textbf{Doris Frontend}: Requiere 3.65 núcleos y 3.6GB RAM
    \begin{itemize}
        \item Instancia recomendada: \texttt{c5.2xlarge} (8 vCPU, 16GB RAM)
    \end{itemize}
    
    \item \textbf{Doris Backends}: Requieren 3.31-3.51 núcleos y 4.1GB RAM cada uno
    \begin{itemize}
        \item Instancia recomendada: \texttt{c5.2xlarge} (8 vCPU, 16GB RAM) para todos los nodos backend
        \item Actualmente muestra 0GB de almacenamiento, pero deberíamos asignar algo de almacenamiento EBS para crecimiento
    \end{itemize}
\end{itemize}

\subsubsection{Servicio de Almacenamiento}

\begin{itemize}
    \item \textbf{S3}: Reemplazando MinIO con Amazon S3 para almacenamiento de objetos (8.4GB inicialmente)
    \begin{itemize}
        \item No se requiere instancia EC2 ya que es un servicio gestionado
    \end{itemize}
\end{itemize}

\subsection{Cálculo de Costos Mensuales}

\subsubsection{Costos de Instancias EC2 (Precios bajo demanda en us-east-1)}

\begin{itemize}
    \item \texttt{c5.large}: \$0.085 por hora
    \item \texttt{r5.large}: \$0.126 por hora
    \item \texttt{c5.2xlarge}: \$0.34 por hora
\end{itemize}

\begin{table}[h]
\centering
\begin{tabular}{|l|l|c|r|}
\hline
\textbf{Componente} & \textbf{Tipo de Instancia} & \textbf{Cantidad} & \textbf{Costo Mensual} \\
\hline
Job Manager & c5.large & 1 & \$0.085 × 730 = \$62.05 \\
\hline
Task Managers & r5.large & 4 & \$0.126 × 4 × 730 = \$367.92 \\
\hline
Nodos Kafka & c5.large & 3 & \$0.085 × 3 × 730 = \$186.15 \\
\hline
Doris Frontend & c5.2xlarge & 1 & \$0.34 × 730 = \$248.20 \\
\hline
Doris Backends & c5.2xlarge & 3 & \$0.34 × 3 × 730 = \$744.60 \\
\hline
\textbf{Total EC2} & & & \textbf{\$1,608.92} \\
\hline
\end{tabular}
\end{table}

\subsubsection{Costos de Almacenamiento EBS}

\begin{itemize}
    \item Volumen gp3: \$0.08 por GB-mes
\end{itemize}

\begin{table}[h]
\centering
\begin{tabular}{|l|c|c|r|}
\hline
\textbf{Componente} & \textbf{Tamaño de Almacenamiento} & \textbf{Cantidad} & \textbf{Costo Mensual} \\
\hline
Nodos Kafka & 38 GB & 3 & \$0.08 × 38 × 3 = \$9.12 \\
\hline
Doris Backends & 20 GB (mínimo) & 3 & \$0.08 × 20 × 3 = \$4.80 \\
\hline
\textbf{Total EBS} & & & \textbf{\$13.92} \\
\hline
\end{tabular}
\end{table}

\subsubsection{Costos de Almacenamiento S3}

\begin{itemize}
    \item Almacenamiento S3 Estándar: \$0.025 por GB-mes
    \item Requisito de almacenamiento S3: 8.4 GB
    \item Costo de almacenamiento S3: \$0.025 × 8.4 = \$0.21 por mes
\end{itemize}

\subsubsection{Costos de Transferencia de Datos de Red}

\begin{itemize}
    \item Dentro de la misma AZ: Gratis
    \item Entre AZs en la misma región: \$0.01 por GB
    \item Transferencia total de datos: $\sim$622.6 GB
\end{itemize}

Según la suposición actualizada, el 25\% del tráfico está dentro de la misma AZ y el 75\% está entre AZs:
\begin{itemize}
    \item Costo entre AZs: 622.6 GB × 0.75 × \$0.01 = \$4.67 por mes
\end{itemize}

\subsubsection{Costos de EKS}

\begin{itemize}
    \item Clúster EKS: \$0.10 por hora = \$73 por mes
\end{itemize}

\subsubsection{Costo Mensual Total}

\begin{table}[h]
\centering
\begin{tabular}{|l|r|}
\hline
\textbf{Categoría de Costo} & \textbf{Importe Mensual} \\
\hline
Instancias EC2 & \$1,608.92 \\
\hline
Almacenamiento EBS & \$13.92 \\
\hline
Almacenamiento S3 & \$0.21 \\
\hline
Transferencia de Datos de Red & \$4.67 \\
\hline
Clúster EKS & \$73.00 \\
\hline
\textbf{Costo Mensual Total Estimado} & \textbf{\$1,700.72} \\
\hline
\end{tabular}
\end{table}

\subsection{Suposiciones y Consideraciones}

\begin{enumerate}
    \item Los porcentajes de CPU son relativos a un solo núcleo (100\% = 1 núcleo)
    \item Hemos colocado componentes en instancias EC2 separadas para aislamiento y escalado
    \item Los patrones de tráfico de red son estimados
    \item Se asumen volúmenes gp3 estándar
    \item Los precios se basan en tarifas bajo demanda en la región us-east-1 a abril de 2025
\end{enumerate}